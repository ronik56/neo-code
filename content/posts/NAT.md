---
title: "על NAT"
date: 2020-09-07T11:33:15+03:00
draft: true
featured_image:
---

כידוע, כשאנחנו משתמשים באינטרנט אנחנו זקוקים לכתובת IP. כמו דואר רגיל, יש צורך בנמען ומוען- גם למחשב ששולח בקשה וגם לשרת שאליו היא נשלחת צריכה להיות כתובת IP כדי שידעו איך לתקשר ביניהם. הבעיה היא שיש מעט מדי כתובות IP.  כתובת IP היא צירוף של 4 מספרים מ-0 עד 255. בפועל יש קצת יותר מ-4 מיליארד כתובות IP זמינות לשימוש. מסתבר שזה לא מספיק לכמות המחשבים המחוברים באינטרנט. לכן פותח פרוטוקול IPv6 שבו הכתובות כוללות אותיות והן ארוכות יותר, מה שמגדיל את מספר הכתובות הזמינות לשימוש מ-4 מיליארד  ל-340 undecillion, שזה 340 ואז 36 ספרות אחריו (340,282,366,920,938,463,463,374,607,431,768,211,456).  IPv6 כבר זמין לשימוש בהרבה מקומות ובשנים הקרובות נעבור אליו באופן רשמי, אבל מה אנחנו עושים עד אז?

כאן נכנס ה-NAT (Network Address Translation) לתמונה, ביחד עם כתובות IP פרטיות. כתובות ה-IP מחולקות לציבוריות ופרטיות. כתובות IP ציבוריות רשומות באופן פומבי וכולם יכולים לגשת אליהן. זו תהיה הכתובת של הראוטר שלכם ושל השרת שהאתר שאתם ניגשים אליו יושב עליו. לעומת זאת, כתובות IP פרטיות לא רשומות באופן פומבי וניתן לגשת אליהן רק בתוך הרשת, כלומר רק בתוך הבית או העסק. 

ניקח לדוגמה את הרשת הביתית שלכם. הראוטר שלכם מקבל כתובת IP מהספקית שלכם. בשביל לחסוך 10-20 כתובות IP לכל מכשיר שמחובר לרשת הביתית שלכם, הראוטר משתמש NAT. הראוטר מחלק לכל המכשירים שמחוברים אליו כתובות פרטיות, ששייכות לכמה טווחים שנקבעו לשימוש זה (16.7 מיליון שמתחילות ב-10, מיליון שמתחילות ב-172.16-31 ו-65.5 אלף שמתחילות ב-192.168). לרוב הכתובות יגיעו בטווח שנקבע בהגדרות, לדוגמה 192.168.0.0-255. לדוגמה המחשב יהיה עם הכתובת 192.168.0.1, הפלאפון 192.168.0.2 וכו'. כשאתם תגישו בקשה לאינטרנט, ה-NAT ימיר את הכתובת הפרטית לכתובת הציבורית ולכן כלפי חוץ כל המכשירים ברשת יחלקו אותה כתובת IP. ה-NAT עובד גם בכיוון השני, כשהבקשה חוזרת מהאינטרנט לכתובת הציבורית ואז ה-NAT צריך להעביר אותה לכתובת הפרטית הנכונה (כלומר להחליט אם היא מגיעה למחשב או לפלאפון).

יש ארבעה סוגי NAT:
1. SNAT - Static NAT: מדובר ב-NAT שמספק כתובת IP ציבורית קבועה לכל כתובת IP פנימית. אם להמשיך עם הדוגמה שלמעלה, אז נוכל לשייך את הכתובת הציבורית 91.198.174.192 לכתובת 192.168.0.1 וכך כל מי שניגש לכתובת  91.198.174.192 יגש למחשב שלנו (או דוגמה יותר ריאליסטית- שרת FTP). כל מי שיגש לכתובת  91.198.174.193 יופנה לכתובת 192.168.0.2, כלומר לפלאפון (או לשרת ווב, כלומר לאתר). הכתובות לא חייבות להיות עוקבות כמובן. מדובר ב-NAT מאוד בזבזני ומשמש בעיקר לתנועה נכנסת. 

2. DNAT - Dynamic NAT: בדומה ל-NAT סטטי גם DNAT מספק כתובת ציבורת לכל כתובת פרטית, אבל הצורה קצת שונה. כאן הראוטר מחזיק במלאי של כתובת IP וכל בקשה של כתובת IP פנימית מנותבת לכתובת IP זמינה ברשימה. לדוגמה, אם נתחבר עם המחשב, כלומר עם 192.168.0.1, נקבל את הכתובת 83.2.3.1. לאחר מכן נתחבר עם הפלאפון, ונקבל את הכתובת 83.2.3.2 וכן הלאה, כשכל מכשיר מקבל כתובת פנויה וכתובות מתפנות אחרי שהמשתמש התנתק. גם גישה זו בזבזנית והיא משמשת בעיקר לצורכי תנועה יוצאת. שיטה זו למעשה מסתירה את ה-IP של המשתמשים ומקשה על תוקפים חיצונים לזהות אותו, שכן כתובת ה-IP שלו משתנה באופן תכוף. 

3. PAT - Port Address Translation: הצורה הכי נפוצה של ה-NAT. כאן לכל מכשיר ברשת הפנימית (פלאפון, מחשב) יש כתובת IP פרטית (192.168.0.1, 192.168.0.2) ולראוטר יש כתובת IP ציבורית (91.198.174.192). במעבר בין הרשת הפנימית לחיצונית, כתובת ה-IP הפרטית מוחלפת לכתובת IP ציבורית עם תוספת של פורט. לדוגמה פניה מהמחשב תגיע לראוטר ותצא ממנו בצורה 91.198.174.192:8001 לדוגמה, והפניה מהפלאפון תצא בצורה 91.198.174.192:8002. כך ה-NAT יודע לנווט בקלות את הטראפיק ויודע איזה מידע אמור להגיע לאיזה מכשיר בדיוק. יש כ-65.5 אלף פורטים זמינים לשימוש, חלקם שמורים לשימושים מסוימים (לדוגמה 22 ל-SSH, כאשר 80 שמור ל-HTTP ו-443 ל-HTTPS וכו'), אך יש עשרות אלפים שזמינים לשימוש. 

4. Port Forwarding: רלוונטית בעיקר כשיש רק כתובת IP ציבורית אחת, אבל מספר שרתים ציבוריים שצריכים לחלוק אותה, ולכן גם בעיקר רלוונטית כשמדובר בתנועה נכנסת. כך לדוגמה אם נרצה לגשת לשרת ה-FTP שלנו, שכתובת ה-IP הפרטית שלו היא (192.168.0.1) וכתובת ה-IP הציבורית שלנו היא 91.198.174.192, אז עם Port Forwarding נוכל להפנות כל גישה לכתובת 91.198.174.192:21 לשרת ה-FTP שלנו. בדומה נוכל להפנות את הכתובת 91.198.174.192:25 לכתובת 192.168.0.2 שמשתמשת את שרת המייל שלנו, את הכתובת 91.198.174.192:80 לשרת ה-Web שלנו שנמצא בכתובת 192.168.0.3 וכו'. 

ה-NAT כמובן לא חף מחסרונות. תרגום הכתובות לוקח זמן שיוצר דיליי ועלול לפגוע בביצועים (אם כי לא סביר שיורגש), תוכנות מסוימות עלולות לא לעבוד בגלל הגדרות לא נכונות, במיוחד אפליקציות שדורשות פורטים ספציפיים כמו שרתי Web או טורנטים והדבר גם יכול לפגוע בפרוטוקולי תקשורת כמו IPSec ובעיות דומות, אם כי לא נפוצות במיוחד.

לסיכום, NAT זו טכנולוגיה שמתרגמת כתובות IP פרטיות וציבוריות ומאפשרת לנו לקבל אבטחה מוספת על ידי הסתרת כתובות IP של מכשירי קצה, להאריך את תוחלת החיים של ה-IPv4 על ידי חיסכון בכתובות ציבוריות ולהפריד את הרשת הפנימית שלנו מהרשת החיצונית. עם המעבר ל-IPv6 בעתיד הקרוב, לכל מכשיר קצה תהיה כתובת IP ציבורית משלו וה-NAT יהפוך מהר מאוד לנחלת העבר.
